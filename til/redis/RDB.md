# Redis DataBase

레디스 영구 저장 메커니즘으로 특정 시점(스냅샷)의 메모리 데이터를 디스크에 바이너리 파일(dump.rdb)로 저장한다.

- 데이터 백업 → 장애 발생시 복구 가능성

## RDB 저장 파일 생성 명령어

- **SAVE**
  
    현재 스레드를 차단 후 RDB 파일 저장
  - 다른 클라이언트의 요청을 처리 못 한다. (동기)


- **BGSAVE**

    자식 프로세스 생성(Fork) 후 자식 프로세스에서 RDB 저장 
  - 메인 프로세스는 파일 저장 중에도 클라이언트 요청을 처리할 수 있다 (비동기)

## fork()

Unix의 fork() 함수는 0을 반환하면 현재 프로세스가 **자식 프로세스**라는 것을 의미하고, 0이 아닌 값을 반환하면 현재 프로세스가 **부모 프로세스**이고, 반환값은 자식 프로세스의 PID라는 것을 의미한다.

```
if (fork() == 0) {
    // 자식 프로세스
} else {
    // 부모 프로세스
}
```

## 자식 프로세스가 부모 프로세스의 메모리를 완전히 복사해야 하는 시점은 언제?

자식 프로세스를 생성하며 부모 프로세스의 메모리를 복사해오면 매우 비효율적이다. == fork() 함수가 많은 오버헤드를 가져올 것이다.

### Copy-on-Write

CoW 메커니즘을 사용하여 fork() 함수는 부모 프로세스가 메모리를 수정할 때 복사된다.

메모리가 수정되면 페이지 단위로 복사가 발생한다.

---

https://man7.org/linux/man-pages/man2/fork.2.html